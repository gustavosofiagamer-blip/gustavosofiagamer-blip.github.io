<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Batalha das Bolas</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#0d0d0d;
}
canvas{display:block}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

// ===== CONFIG =====
const FPS = 60;
const RAIO = 16;
const VELOCIDADE = 3;

const CORES = [
  {nome:"Amarelo", cor:"#FFD700"},
  {nome:"Vermelho", cor:"#FF3B3B"},
  {nome:"Azul", cor:"#2EA0FF"},
  {nome:"Verde", cor:"#2EFF6A"}
];

// ===== ESTADO =====
let estado = "roleta";
let roletas = [];
let coresEscolhidas = [];

let bolaA, bolaB;
let itens = [];
let flechas = [];
let confetes = [];

let framesRoleta = 120;
let esperaResultado = 0;

// ===== INPUT =====
const teclas = {};
addEventListener("keydown", e => teclas[e.key] = true);
addEventListener("keyup", e => teclas[e.key] = false);

// ===== ROLETAS =====
function criarRoleta(x,y){
  return {x,y,angulo:Math.random()*Math.PI*2,vel:0.45};
}

function desenharRoleta(r){
  const raio=120;
  const fatia=(Math.PI*2)/CORES.length;

  ctx.save();
  ctx.translate(r.x,r.y);
  ctx.rotate(r.angulo);

  for(let i=0;i<CORES.length;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.fillStyle=CORES[i].cor;
    ctx.arc(0,0,raio,i*fatia,(i+1)*fatia);
    ctx.fill();
  }
  ctx.restore();

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.moveTo(r.x,r.y-raio-20);
  ctx.lineTo(r.x-14,r.y-raio);
  ctx.lineTo(r.x+14,r.y-raio);
  ctx.fill();
}

function corDaRoleta(r){
  const fatia=(Math.PI*2)/CORES.length;
  let ang=(-r.angulo-Math.PI/2)%(Math.PI*2);
  if(ang<0) ang+=Math.PI*2;
  return CORES[Math.floor(ang/fatia)];
}

// ===== BATALHA =====
function criarBola(x,cor){
  return{
    x,
    y:canvas.height/2,
    vx:0,
    vy:0,
    cor,
    vida:3,
    espada:false,
    flechas:0
  };
}

function criarItem(){
  const tipos=["espada","arco"];
  return{
    tipo:tipos[Math.floor(Math.random()*2)],
    x:Math.random()*(canvas.width-40)+20,
    y:Math.random()*(canvas.height-40)+20
  };
}

function iniciarBatalha(){
  bolaA = criarBola(canvas.width*0.25,coresEscolhidas[0].cor);
  bolaB = criarBola(canvas.width*0.75,coresEscolhidas[1].cor);
  itens=[];
  flechas=[];
  estado="batalha";
}

// ===== LOOP =====
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // --- ROLETAS ---
  if(estado==="roleta"){
    if(roletas.length===0){
      roletas=[
        criarRoleta(canvas.width*0.35,canvas.height/2),
        criarRoleta(canvas.width*0.65,canvas.height/2)
      ];
      framesRoleta=120;
      esperaResultado=0;
    }

    roletas.forEach(r=>{
      if(framesRoleta>0){
        r.angulo+=r.vel;
        r.vel*=0.985;
      }
      desenharRoleta(r);
    });

    framesRoleta--;
    if(framesRoleta===0){
      let c1=corDaRoleta(roletas[0]);
      let c2=corDaRoleta(roletas[1]);
      if(c1.nome===c2.nome)
        c2=CORES[(CORES.indexOf(c2)+1)%CORES.length];
      coresEscolhidas=[c1,c2];
      esperaResultado=300;
    }

    if(esperaResultado>0){
      esperaResultado--;
      if(esperaResultado===0){
        roletas=[];
        iniciarBatalha();
      }
    }
  }

  // --- BATALHA ---
  if(estado==="batalha"){
    if(Math.random()<0.01 && itens.length<2)
      itens.push(criarItem());

    // MOVIMENTO BOLA A
    if(teclas["w"]) bolaA.y-=VELOCIDADE;
    if(teclas["s"]) bolaA.y+=VELOCIDADE;
    if(teclas["a"]) bolaA.x-=VELOCIDADE;
    if(teclas["d"]) bolaA.x+=VELOCIDADE;

    // MOVIMENTO BOLA B
    if(teclas["ArrowUp"]) bolaB.y-=VELOCIDADE;
    if(teclas["ArrowDown"]) bolaB.y+=VELOCIDADE;
    if(teclas["ArrowLeft"]) bolaB.x-=VELOCIDADE;
    if(teclas["ArrowRight"]) bolaB.x+=VELOCIDADE;

    // DISPAROS
    if(teclas["q"] && bolaA.flechas>0){
      flechas.push({x:bolaA.x,y:bolaA.y,dx:6,alvo:bolaB});
      bolaA.flechas--;
      teclas["q"]=false;
    }
    if(teclas["Shift"] && bolaB.flechas>0){
      flechas.push({x:bolaB.x,y:bolaB.y,dx:-6,alvo:bolaA});
      bolaB.flechas--;
      teclas["Shift"]=false;
    }

    // LIMITES + DESENHO
    [bolaA,bolaB].forEach(b=>{
      b.x=Math.max(RAIO,Math.min(canvas.width-RAIO,b.x));
      b.y=Math.max(RAIO,Math.min(canvas.height-RAIO,b.y));
      ctx.beginPath();
      ctx.arc(b.x,b.y,RAIO,0,Math.PI*2);
      ctx.fillStyle=b.cor;
      ctx.fill();
    });

    // ITENS
    itens.forEach((it,i)=>{
      ctx.fillStyle=it.tipo==="espada"?"#ccc":"#8cf";
      ctx.fillRect(it.x-8,it.y-8,16,16);
      [bolaA,bolaB].forEach(b=>{
        if(Math.hypot(b.x-it.x,b.y-it.y)<RAIO+8){
          if(it.tipo==="espada") b.espada=true;
          if(it.tipo==="arco") b.flechas+=2;
          itens.splice(i,1);
        }
      });
    });

    // FLECHAS
    flechas.forEach((f,i)=>{
      f.x+=f.dx;
      ctx.fillStyle="#fff";
      ctx.fillRect(f.x-4,f.y-2,8,4);
      if(Math.abs(f.x-f.alvo.x)<RAIO){
        f.alvo.vida--;
        flechas.splice(i,1);
      }
    });

    // DANO CORPO A CORPO
    if(Math.hypot(bolaA.x-bolaB.x,bolaA.y-bolaB.y)<RAIO*2){
      if(bolaA.espada){ bolaB.vida--; bolaA.espada=false; }
      if(bolaB.espada){ bolaA.vida--; bolaB.espada=false; }
    }

    // HUD
    ctx.fillStyle="#fff";
    ctx.font="24px Arial";
    ctx.fillText("❤️".repeat(bolaA.vida),20,40);
    ctx.fillText("❤️".repeat(bolaB.vida),canvas.width-100,40);

    if(bolaA.vida<=0 || bolaB.vida<=0){
      const vencedora = bolaA.vida>0 ? bolaA : bolaB;
      for(let i=0;i<140;i++){
        confetes.push({
          x:canvas.width/2,
          y:canvas.height/2,
          dx:(Math.random()-0.5)*10,
          dy:(Math.random()-0.5)*10,
          vida:80,
          cor:vencedora.cor
        });
      }
      estado="fim";
    }
  }

  // --- CONFETES ---
  confetes.forEach((c,i)=>{
    c.x+=c.dx; c.y+=c.dy; c.dy+=0.3; c.vida--;
    ctx.fillStyle=c.cor;
    ctx.fillRect(c.x,c.y,4,4);
    if(c.vida<=0) confetes.splice(i,1);
  });

  if(estado==="fim" && confetes.length===0){
    estado="roleta";
  }

  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
