<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Batalha Pixel das Bolas</title>
<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#0b0b0b;
}
canvas{display:block}
</style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

// ===== CONFIG =====
const RAIO = 16;
const VELOCIDADE = 3;
const VELOCIDADE_FLECHA = 6;

// ===== CORES =====
const CORES = [
  {nome:"Amarelo", cor:"#FFD700"},
  {nome:"Vermelho", cor:"#FF3B3B"},
  {nome:"Azul", cor:"#2EA0FF"},
  {nome:"Verde", cor:"#2EFF6A"}
];

// ===== ESTADO =====
let estado = "roleta";
let roletas = [];
let coresEscolhidas = [];

let bolaA, bolaB;
let itens = [];
let flechas = [];

let framesRoleta = 120;
let esperaResultado = 300;

// ===== INPUT =====
const teclas = {};
addEventListener("keydown", e => teclas[e.key] = true);
addEventListener("keyup", e => teclas[e.key] = false);

// ===== ROLETAS =====
function criarRoleta(x,y){
  return {x,y,angulo:Math.random()*Math.PI*2,vel:0.45};
}

function desenharRoleta(r){
  const raio=110;
  const fatia=(Math.PI*2)/CORES.length;
  ctx.save();
  ctx.translate(r.x,r.y);
  ctx.rotate(r.angulo);
  for(let i=0;i<CORES.length;i++){
    ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.fillStyle=CORES[i].cor;
    ctx.arc(0,0,raio,i*fatia,(i+1)*fatia);
    ctx.fill();
  }
  ctx.restore();
}

function corDaRoleta(r){
  const fatia=(Math.PI*2)/CORES.length;
  let ang=(-r.angulo-Math.PI/2)%(Math.PI*2);
  if(ang<0) ang+=Math.PI*2;
  return CORES[Math.floor(ang/fatia)];
}

// ===== PIXEL ART =====
function pixel(x,y,cor){
  ctx.fillStyle=cor;
  ctx.fillRect(x,y,3,3);
}

function spriteEspadaPixel(x,y,rot){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(rot);
  pixel(-3,-15,"#ddd");
  pixel(-3,-12,"#ddd");
  pixel(-3,-9,"#ddd");
  pixel(-3,-6,"#ddd");
  pixel(-6,-3,"#555");
  pixel(-3,-3,"#555");
  pixel(0,-3,"#555");
  ctx.restore();
}

function spriteArcoPixel(x,y){
  ctx.save();
  ctx.translate(x,y);
  pixel(-6,-6,"#8b5a2b");
  pixel(-6,-3,"#8b5a2b");
  pixel(-6,0,"#8b5a2b");
  pixel(-3,-9,"#8b5a2b");
  pixel(0,-12,"#8b5a2b");
  pixel(3,-9,"#8b5a2b");
  ctx.strokeStyle="#eee";
  ctx.beginPath();
  ctx.moveTo(0,-12);
  ctx.lineTo(0,6);
  ctx.stroke();
  ctx.restore();
}

function spriteFlechaPixel(x,y,ang){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(ang);
  pixel(-6,-1,"#ccc");
  pixel(-3,-1,"#ccc");
  pixel(0,-1,"#ccc");
  pixel(3,-1,"#ccc");
  pixel(6,-1,"#ccc");
  pixel(6,-4,"#ccc");
  pixel(9,-1,"#ccc");
  pixel(6,2,"#ccc");
  ctx.restore();
}

// ===== BATALHA =====
function criarBola(x,cor){
  return{
    x,
    y:canvas.height/2,
    cor,
    vida:3,
    espada:false,
    espadaAng:0,
    flechas:0
  };
}

function criarItem(){
  const tipos=["espada","arco"];
  return{
    tipo:tipos[Math.floor(Math.random()*2)],
    x:Math.random()*(canvas.width-40)+20,
    y:Math.random()*(canvas.height-40)+20
  };
}

function iniciarBatalha(){
  bolaA = criarBola(canvas.width*0.25,coresEscolhidas[0].cor);
  bolaB = criarBola(canvas.width*0.75,coresEscolhidas[1].cor);
  itens=[];
  flechas=[];
  estado="batalha";
}

// ===== LOOP =====
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // ROLETAS
  if(estado==="roleta"){
    if(roletas.length===0){
      roletas=[
        criarRoleta(canvas.width*0.35,canvas.height/2),
        criarRoleta(canvas.width*0.65,canvas.height/2)
      ];
      framesRoleta=120;
      esperaResultado=300;
    }

    roletas.forEach(r=>{
      if(framesRoleta>0){
        r.angulo+=r.vel;
        r.vel*=0.985;
      }
      desenharRoleta(r);
    });

    framesRoleta--;
    if(framesRoleta===0){
      let c1=corDaRoleta(roletas[0]);
      let c2=corDaRoleta(roletas[1]);
      if(c1.nome===c2.nome)
        c2=CORES[(CORES.indexOf(c2)+1)%CORES.length];
      coresEscolhidas=[c1,c2];
    }

    esperaResultado--;
    if(esperaResultado===0){
      roletas=[];
      iniciarBatalha();
    }
  }

  // BATALHA
  if(estado==="batalha"){
    if(Math.random()<0.01 && itens.length<2)
      itens.push(criarItem());

    // CONTROLES
    if(teclas["w"]) bolaA.y-=VELOCIDADE;
    if(teclas["s"]) bolaA.y+=VELOCIDADE;
    if(teclas["a"]) bolaA.x-=VELOCIDADE;
    if(teclas["d"]) bolaA.x+=VELOCIDADE;

    if(teclas["ArrowUp"]) bolaB.y-=VELOCIDADE;
    if(teclas["ArrowDown"]) bolaB.y+=VELOCIDADE;
    if(teclas["ArrowLeft"]) bolaB.x-=VELOCIDADE;
    if(teclas["ArrowRight"]) bolaB.x+=VELOCIDADE;

    // DISPARO DIRECIONAL
    if(teclas["q"] && bolaA.flechas>0){
      let dx = bolaB.x - bolaA.x;
      let dy = bolaB.y - bolaA.y;
      let d = Math.hypot(dx,dy);
      dx/=d; dy/=d;
      flechas.push({
        x:bolaA.x,
        y:bolaA.y,
        dx:dx*VELOCIDADE_FLECHA,
        dy:dy*VELOCIDADE_FLECHA,
        ang:Math.atan2(dy,dx),
        alvo:bolaB
      });
      bolaA.flechas--;
      teclas["q"]=false;
    }

    if(teclas["Shift"] && bolaB.flechas>0){
      let dx = bolaA.x - bolaB.x;
      let dy = bolaA.y - bolaB.y;
      let d = Math.hypot(dx,dy);
      dx/=d; dy/=d;
      flechas.push({
        x:bolaB.x,
        y:bolaB.y,
        dx:dx*VELOCIDADE_FLECHA,
        dy:dy*VELOCIDADE_FLECHA,
        ang:Math.atan2(dy,dx),
        alvo:bolaA
      });
      bolaB.flechas--;
      teclas["Shift"]=false;
    }

    // BOLAS + ESPADA GIRANDO
    [bolaA,bolaB].forEach(b=>{
      b.x=Math.max(RAIO,Math.min(canvas.width-RAIO,b.x));
      b.y=Math.max(RAIO,Math.min(canvas.height-RAIO,b.y));
      ctx.beginPath();
      ctx.arc(b.x,b.y,RAIO,0,Math.PI*2);
      ctx.fillStyle=b.cor;
      ctx.fill();

      if(b.espada){
        b.espadaAng+=0.25;
        spriteEspadaPixel(
          b.x + Math.cos(b.espadaAng)*22,
          b.y + Math.sin(b.espadaAng)*22,
          b.espadaAng
        );
      }
    });

    // ITENS
    itens.forEach((it,i)=>{
      if(it.tipo==="espada") spriteEspadaPixel(it.x,it.y,0);
      if(it.tipo==="arco") spriteArcoPixel(it.x,it.y);

      [bolaA,bolaB].forEach(b=>{
        if(Math.hypot(b.x-it.x,b.y-it.y)<RAIO+10){
          if(it.tipo==="espada") b.espada=true;
          if(it.tipo==="arco") b.flechas+=2;
          itens.splice(i,1);
        }
      });
    });

    // FLECHAS
    flechas.forEach((f,i)=>{
      f.x+=f.dx;
      f.y+=f.dy;
      spriteFlechaPixel(f.x,f.y,f.ang);

      if(Math.hypot(f.x-f.alvo.x,f.y-f.alvo.y)<RAIO){
        f.alvo.vida--;
        flechas.splice(i,1);
      }
    });

    // DANO ESPADA
    if(Math.hypot(bolaA.x-bolaB.x,bolaA.y-bolaB.y)<RAIO*2){
      if(bolaA.espada){ bolaB.vida--; bolaA.espada=false; }
      if(bolaB.espada){ bolaA.vida--; bolaB.espada=false; }
    }

    // HUD
    ctx.fillStyle="#fff";
    ctx.font="26px Arial";
    ctx.fillText("❤️".repeat(bolaA.vida),20,40);
    ctx.fillText("❤️".repeat(bolaB.vida),canvas.width-120,40);

    if(bolaA.vida<=0 || bolaB.vida<=0){
      estado="roleta";
    }
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>

